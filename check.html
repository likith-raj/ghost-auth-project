<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WORLD FLAG MAP - LIVE DATA</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100vh;
            transition: all 0.5s ease;
        }

        body.light-mode {
            background: #f5f5f5;
        }

        body.dark-mode {
            background: #0a0a0a;
        }

        #map {
            width: 100%;
            height: 100vh;
            z-index: 1;
            transition: all 0.5s ease;
        }

        .country-detail {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
            display: none;
            color: white;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
        }

        .country-detail.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
            z-index: 2001;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .dark-mode .theme-toggle {
            background: rgba(30, 30, 30, 0.9);
            color: #fff;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        .country-flag {
            border-radius: 3px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .country-flag:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(74, 158, 255, 0.4);
        }

        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .info-panel.hidden {
            transform: translateY(100px);
            opacity: 0;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Light theme for Leaflet */
        .light-mode .leaflet-container {
            background: #f8f9fa;
        }

        .light-mode .leaflet-control-zoom a {
            background: #ffffff !important;
            color: #333 !important;
            border: 1px solid #ddd !important;
            transition: all 0.3s ease;
        }

        .light-mode .leaflet-control-zoom a:hover {
            background: #f0f0f0 !important;
            border-color: #bbb !important;
        }

        .light-mode .leaflet-control-attribution {
            background: rgba(255, 255, 255, 0.8) !important;
            color: #666 !important;
        }

        .light-mode .leaflet-control-attribution a {
            color: #0078ff !important;
        }

        .light-mode .leaflet-popup-content-wrapper {
            background: #ffffff !important;
            color: #333 !important;
            border-radius: 8px !important;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .light-mode .leaflet-popup-tip {
            background: #ffffff !important;
        }

        /* Dark theme for Leaflet */
        .dark-mode .leaflet-container {
            background: #000 !important;
        }

        .dark-mode .leaflet-control-zoom a {
            background: rgba(30, 30, 30, 0.9) !important;
            color: #e0e0e0 !important;
            border: 1px solid #444 !important;
            transition: all 0.3s ease;
        }

        .dark-mode .leaflet-control-zoom a:hover {
            background: rgba(50, 50, 50, 0.9) !important;
            border-color: #4a9eff !important;
        }

        .dark-mode .leaflet-control-attribution {
            background: rgba(20, 20, 20, 0.8) !important;
            color: #888 !important;
        }

        .dark-mode .leaflet-control-attribution a {
            color: #4a9eff !important;
        }

        .dark-mode .leaflet-popup-content-wrapper {
            background: rgba(30, 30, 30, 0.95) !important;
            color: #e0e0e0 !important;
            border-radius: 8px !important;
            border: 1px solid #444;
        }

        .dark-mode .leaflet-popup-tip {
            background: rgba(30, 30, 30, 0.95) !important;
            border: 1px solid #444;
        }

        /* Smooth transitions for map elements */
        .leaflet-tile {
            transition: opacity 0.3s ease;
        }

        .leaflet-zoom-animated {
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* Country detail page styling */
        .country-header {
            text-align: center;
            margin-top: 60px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease;
        }

        .country-flag-large {
            width: 150px;
            height: 100px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 3px solid white;
            animation: zoomIn 0.5s ease;
        }

        .country-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .country-capital {
            font-size: 14px;
            color: #ccc;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .country-continent {
            font-size: 12px;
            color: #4a9eff;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInUp 0.6s ease;
            animation-delay: 0.2s;
            animation-fill-mode: both;
        }

        .stat-card:nth-child(2) {
            animation-delay: 0.3s;
        }

        .stat-card:nth-child(3) {
            animation-delay: 0.4s;
        }

        .stat-card:nth-child(4) {
            animation-delay: 0.5s;
        }

        .stat-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4a9eff;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .stat-subtitle {
            font-size: 12px;
            color: #ccc;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-data {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .internet-stats {
            color: white;
            font-family: 'Segoe UI', sans-serif;
            text-align: center;
        }

        .internet-stats .flag {
            width: 80px;
            height: 50px;
            border-radius: 4px;
            margin-bottom: 10px;
            border: 2px solid #fff;
        }

        .internet-stats .country-name {
            font-size: 14px;
            font-weight: 700;
            margin: 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .internet-stats .penetration {
            font-size: 12px;
            font-weight: 600;
            margin: 8px 0;
            text-transform: uppercase;
        }

        .internet-stats .speed-stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .internet-stats .speed-stat {
            flex: 1;
            text-align: center;
        }

        .internet-stats .speed-value {
            font-size: 12px;
            font-weight: 700;
            margin-top: 3px;
            text-transform: uppercase;
        }

        .internet-stats .additional-stats {
            font-size: 10px;
            margin: 8px 0;
            font-weight: 600;
            line-height: 1.4;
            text-transform: uppercase;
        }

        .internet-stats .global-rank {
            font-size: 12px;
            font-weight: 700;
            margin: 10px 0;
            color: #4a9eff;
            text-transform: uppercase;
        }

        .internet-stats .last-updated {
            font-size: 9px;
            color: #ccc;
            margin-top: 5px;
            text-transform: uppercase;
        }

        /* News Section */
        .news-section {
            margin-top: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .news-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #4a9eff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .news-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .news-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }

        .news-source {
            font-size: 10px;
            color: #4a9eff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .news-headline {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .news-date {
            font-size: 9px;
            color: #aaa;
            text-transform: uppercase;
        }

        /* Search Bar */
        .search-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 300px;
        }

        .search-bar {
            width: 100%;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .search-bar:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.9);
            border-color: #4a9eff;
            box-shadow: 0 0 15px rgba(74, 158, 255, 0.3);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
        }

        .search-result-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-size: 12px;
            border-bottom: 1px solid #333;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        /* Live Data Indicators */
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 1.5s infinite;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Weather Widget */
        .weather-widget {
            position: absolute;
            top: 20px;
            right: 80px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            font-size: 12px;
            text-transform: uppercase;
            display: none;
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .weather-temp {
            font-weight: 700;
            font-size: 14px;
        }

        .weather-desc {
            color: #ccc;
        }

        /* NEW FEATURES */

        /* Timezone Display */
        .timezone-widget {
            position: absolute;
            top: 20px;
            right: 150px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            font-size: 12px;
            text-transform: uppercase;
            display: none;
        }

        /* Comparison Panel */
        .comparison-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .comparison-panel.hidden {
            transform: translateY(100px);
            opacity: 0;
        }

        .comparison-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #4a9eff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .comparison-item {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .comparison-country {
            font-weight: 600;
        }

        .comparison-value {
            color: #4a9eff;
            font-weight: 700;
        }

        /* Progress Bars */
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4a9eff;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Country Comparison Chart */
        .comparison-chart {
            margin-top: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 15px;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .chart-label {
            width: 150px;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .chart-value {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 0 10px;
            overflow: hidden;
        }

        .chart-fill {
            height: 100%;
            background: #4a9eff;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .chart-number {
            width: 50px;
            text-align: right;
            font-size: 12px;
            font-weight: 700;
        }

        /* Filter Panel */
        .filter-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px;
            border-radius: 10px;
            width: 200px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            transform: translateX(0);
            transition: all 0.3s ease;
        }

        .filter-panel.hidden {
            transform: translateX(250px);
        }

        .filter-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #4a9eff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }

        .filter-checkbox {
            margin-right: 8px;
        }

        .filter-label {
            font-size: 11px;
            text-transform: uppercase;
        }

        /* Export Button */
        .export-button {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .export-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-container {
                width: 250px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .news-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-panel {
                width: 180px;
            }
            
            .comparison-panel {
                max-width: 250px;
            }
        }

        /* Enhanced Map Controls */
        .map-controls {
            position: absolute;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-control-button {
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            transition: all 0.3s ease;
        }

        .map-control-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        /* Data Visualization */
        .data-visualization {
            margin-top: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .visualization-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #4a9eff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .visualization-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .visualization-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .visualization-name {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .visualization-value {
            font-size: 14px;
            font-weight: 700;
            color: #4a9eff;
        }

        .visualization-chart {
            height: 100px;
            display: flex;
            align-items: flex-end;
            gap: 2px;
        }

        .visualization-bar {
            flex: 1;
            background: #4a9eff;
            border-radius: 2px 2px 0 0;
            transition: height 0.5s ease;
        }
    </style>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="mobile.css">
    </head>
</head>
<body class="dark-mode">
    <button class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon"></i>
    </button>

    <div class="search-container">
        <input type="text" class="search-bar" id="searchBar" placeholder="SEARCH COUNTRY...">
        <div class="search-results" id="searchResults"></div>
    </div>

    <div class="weather-widget" id="weatherWidget">
        <div class="weather-info">
            <div class="weather-temp" id="weatherTemp">--°C</div>
            <div class="weather-desc" id="weatherDesc">LOADING...</div>
        </div>
    </div>

    <div class="timezone-widget" id="timezoneWidget">
        <div class="timezone-info">
            <div class="timezone-time" id="timezoneTime">--:--:--</div>
            <div class="timezone-name" id="timezoneName">LOADING...</div>
        </div>
    </div>

    <div class="info-panel" id="countryInfo">
        <div class="internet-stats">
            <i class="fas fa-flag" style="color: #4a9eff; margin-bottom: 8px;"></i>
            <div style="font-size: 11px; color: #ccc; text-transform: uppercase; letter-spacing: 1px;">CLICK ON ANY FLAG TO SEE COUNTRY INFORMATION</div>
        </div>
    </div>

    <div class="comparison-panel hidden" id="comparisonPanel">
        <div class="comparison-title">TOP COUNTRIES BY INTERNET SPEED</div>
        <div id="comparisonList"></div>
    </div>

    <div class="filter-panel hidden" id="filterPanel">
        <div class="filter-title">FILTER BY CONTINENT</div>
        <div class="filter-option">
            <input type="checkbox" class="filter-checkbox" id="filterAfrica" checked>
            <label for="filterAfrica" class="filter-label">AFRICA</label>
        </div>
        <div class="filter-option">
            <input type="checkbox" class="filter-checkbox" id="filterAsia" checked>
            <label for="filterAsia" class="filter-label">ASIA</label>
        </div>
        <div class="filter-option">
            <input type="checkbox" class="filter-checkbox" id="filterEurope" checked>
            <label for="filterEurope" class="filter-label">EUROPE</label>
        </div>
        <div class="filter-option">
            <input type="checkbox" class="filter-checkbox" id="filterNorthAmerica" checked>
            <label for="filterNorthAmerica" class="filter-label">NORTH AMERICA</label>
        </div>
        <div class="filter-option">
            <input type="checkbox" class="filter-checkbox" id="filterSouthAmerica" checked>
            <label for="filterSouthAmerica" class="filter-label">SOUTH AMERICA</label>
        </div>
        <div class="filter-option">
            <input type="checkbox" class="filter-checkbox" id="filterOceania" checked>
            <label for="filterOceania" class="filter-label">OCEANIA</label>
        </div>
    </div>

    <div class="map-controls">
        <button class="map-control-button" id="filterToggle" title="Toggle Filters">
            <i class="fas fa-filter"></i>
        </button>
        <button class="map-control-button" id="comparisonToggle" title="Show Comparison">
            <i class="fas fa-chart-bar"></i>
        </button>
        <button class="map-control-button" id="resetView" title="Reset View">
            <i class="fas fa-globe-americas"></i>
        </button>
    </div>

    <button class="export-button" id="exportButton">
        <i class="fas fa-download"></i> EXPORT DATA
    </button>

    <div class="loading" id="loading">
        <i class="fas fa-spinner fa-spin pulse" style="margin-right: 10px;"></i>
        LOADING WORLD FLAG MAP...
    </div>

    <div id="map"></div>

    <div class="country-detail" id="countryDetail">
        <button class="back-button" id="backButton">
            <i class="fas fa-arrow-left"></i> BACK TO MAP
        </button>
        
        <div class="country-header">
            <img id="detailFlag" src="" alt="" class="country-flag-large">
            <h1 id="detailName" class="country-name">COUNTRY NAME</h1>
            <div id="detailCapital" class="country-capital">CAPITAL CITY</div>
            <div id="detailContinent" class="country-continent">CONTINENT</div>
        </div>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-title">
                    <i class="fas fa-globe-americas"></i>
                    <span>INTERNET STATISTICS <span class="live-indicator"></span></span>
                </div>
                <div class="stat-value" id="internetPenetration">72.2%</div>
                <div class="stat-subtitle">INTERNET PENETRATION</div>
                
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">INTERNET USERS</div>
                        <div class="stat-data" id="internetUsers">47.6M</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">MOBILE USERS</div>
                        <div class="stat-data" id="mobileUsers">18.4M</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">BROADBAND USERS</div>
                        <div class="stat-data" id="broadbandUsers">71.2M</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">PRICE PER GB</div>
                        <div class="stat-data" id="pricePerGB">$18.76</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>CONNECTION SPEED</span>
                </div>
                <div class="stat-value" id="downloadSpeed">73.3 MBPS</div>
                <div class="stat-subtitle">DOWNLOAD SPEED</div>
                
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">UPLOAD SPEED</div>
                        <div class="stat-data" id="uploadSpeed">19.8 MBPS</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">LATENCY</div>
                        <div class="stat-data" id="latency">18 MS</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">GLOBAL RANK</div>
                        <div class="stat-data" id="globalRank">47</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">GDP PER CAPITA</div>
                        <div class="stat-data" id="gdpPerCapita">$974.3K</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">
                    <i class="fas fa-chart-line"></i>
                    <span>POPULATION & ECONOMY</span>
                </div>
                <div class="stat-value" id="population">67.2M</div>
                <div class="stat-subtitle">TOTAL POPULATION</div>
                
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">URBAN POPULATION</div>
                        <div class="stat-data" id="urbanPopulation">83.2%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">MEDIAN AGE</div>
                        <div class="stat-data" id="medianAge">40.5</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">GDP GROWTH</div>
                        <div class="stat-data" id="gdpGrowth">1.3%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">UNEMPLOYMENT</div>
                        <div class="stat-data" id="unemployment">4.2%</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">
                    <i class="fas fa-network-wired"></i>
                    <span>INFRASTRUCTURE</span>
                </div>
                <div class="stat-value" id="infrastructureIndex">78.5</div>
                <div class="stat-subtitle">INFRASTRUCTURE INDEX</div>
                
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">5G COVERAGE</div>
                        <div class="stat-data" id="fiveGCoverage">65%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">FIBER OPTIC</div>
                        <div class="stat-data" id="fiberOptic">42%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">PUBLIC WIFI</div>
                        <div class="stat-data" id="publicWifi">12.4K</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">LAST UPDATED</div>
                        <div class="stat-data" id="lastUpdated">11:25:45 PM</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="comparison-chart" id="comparisonChart">
            <div class="news-title">
                <i class="fas fa-chart-bar"></i>
                <span>COUNTRY COMPARISON</span>
            </div>
            <div class="chart-container" id="chartContainer">
                <!-- Chart will be generated here -->
            </div>
        </div>

        <div class="data-visualization">
            <div class="visualization-title">
                <i class="fas fa-chart-pie"></i>
                <span>DATA VISUALIZATION</span>
            </div>
            <div class="visualization-grid" id="visualizationGrid">
                <!-- Visualization cards will be generated here -->
            </div>
        </div>

        <div class="news-section">
            <div class="news-title">
                <i class="fas fa-newspaper"></i>
                <span>LATEST NEWS</span>
            </div>
            <div class="news-grid" id="newsGrid">
                <div class="news-card">
                    <div class="news-source">LOADING NEWS...</div>
                    <div class="news-headline">Please wait while we fetch the latest news</div>
                    <div class="news-date">--</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize the map with smooth controls
        const map = L.map('map', {
            zoomControl: true,
            fadeAnimation: true,
            zoomAnimation: true,
            markerZoomAnimation: true,
            transform3DLimit: 500,
            inertia: true,
            inertiaDeceleration: 3000,
            inertiaMaxSpeed: 1500,
            easeLinearity: 0.3,
            worldCopyJump: false,
            maxBoundsViscosity: 0.7
        }).setView([20, 0], 2);

        // Tile layers
        const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20,
        });

        const lightLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19,
        });

        // Start with dark layer
        darkLayer.addTo(map);

        // Store markers for search functionality
        let countryMarkers = {};
        let countryStats = {};
        let currentCountry = null;

        // Function to generate random internet statistics
        function generateInternetStats(country) {
            // Base values that vary by country size/development
            const basePenetration = Math.random() * 40 + 30; // 30-70%
            const baseDownload = Math.random() * 100 + 20; // 20-120 Mbps
            const baseUpload = baseDownload * (Math.random() * 0.4 + 0.3); // 30-70% of download
            const baseLatency = Math.floor(Math.random() * 40 + 10); // 10-50 ms
            const baseMobileUsers = Math.floor(Math.random() * country.population.replace('M', '') * 0.8 + country.population.replace('M', '') * 0.2);
            const baseBroadband = Math.floor(Math.random() * country.population.replace('M', '') * 0.7 + country.population.replace('M', '') * 0.3);
            const basePrice = (Math.random() * 15 + 5).toFixed(2); // $5-20 per GB
            const baseGDP = (Math.random() * 900 + 100).toFixed(1); // $100k - $1000k
            const baseRank = Math.floor(Math.random() * 150 + 1); // Rank 1-150
            
            // Additional stats for detail page
            const urbanPopulation = (Math.random() * 40 + 60).toFixed(1); // 60-100%
            const medianAge = (Math.random() * 20 + 25).toFixed(1); // 25-45
            const gdpGrowth = (Math.random() * 4 - 1).toFixed(1); // -1% to 3%
            const unemployment = (Math.random() * 10 + 2).toFixed(1); // 2-12%
            const infrastructureIndex = (Math.random() * 40 + 60).toFixed(1); // 60-100
            const fiveGCoverage = (Math.random() * 70 + 10).toFixed(0); // 10-80%
            const fiberOptic = (Math.random() * 60 + 20).toFixed(0); // 20-80%
            const publicWifi = Math.floor(Math.random() * 20000 + 5000); // 5k-25k
            
            return {
                penetration: basePenetration.toFixed(1),
                users: Math.floor(country.population.replace('M', '') * basePenetration / 100) + 'M',
                download: baseDownload.toFixed(1),
                upload: baseUpload.toFixed(1),
                latency: baseLatency,
                mobileUsers: baseMobileUsers + 'M',
                broadband: baseBroadband + 'M',
                price: basePrice,
                gdp: baseGDP,
                rank: baseRank,
                lastUpdated: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'}).toUpperCase(),
                urbanPopulation: urbanPopulation,
                medianAge: medianAge,
                gdpGrowth: gdpGrowth,
                unemployment: unemployment,
                infrastructureIndex: infrastructureIndex,
                fiveGCoverage: fiveGCoverage,
                fiberOptic: fiberOptic,
                publicWifi: publicWifi.toLocaleString()
            };
        }

        // Comprehensive country data with coordinates and flag URLs
        const countries = [
            
            // North America
            { name: "UNITED STATES", lat: 39.8283, lng: -98.5795, flag: "https://flagcdn.com/w320/us.png", capital: "WASHINGTON D.C.", population: "331M", continent: "NORTH AMERICA", code: "US" },
            { name: "CANADA", lat: 56.1304, lng: -106.3468, flag: "https://flagcdn.com/w320/ca.png", capital: "OTTAWA", population: "38M", continent: "NORTH AMERICA", code: "CA" },
            { name: "MEXICO", lat: 23.6345, lng: -102.5528, flag: "https://flagcdn.com/w320/mx.png", capital: "MEXICO CITY", population: "126M", continent: "NORTH AMERICA", code: "MX" },
            
            // Central America & Caribbean
            { name: "GUATEMALA", lat: 15.7835, lng: -90.2308, flag: "https://flagcdn.com/w320/gt.png", capital: "GUATEMALA CITY", population: "17M", continent: "NORTH AMERICA", code: "GT" },
            { name: "CUBA", lat: 21.5218, lng: -77.7812, flag: "https://flagcdn.com/w320/cu.png", capital: "HAVANA", population: "11M", continent: "NORTH AMERICA", code: "CU" },
            { name: "DOMINICAN REPUBLIC", lat: 18.7357, lng: -70.1627, flag: "https://flagcdn.com/w320/do.png", capital: "SANTO DOMINGO", population: "10M", continent: "NORTH AMERICA", code: "DO" },
            { name: "HAITI", lat: 18.9712, lng: -72.2852, flag: "https://flagcdn.com/w320/ht.png", capital: "PORT-AU-PRINCE", population: "11M", continent: "NORTH AMERICA", code: "HT" },
            { name: "JAMAICA", lat: 18.1096, lng: -77.2975, flag: "https://flagcdn.com/w320/jm.png", capital: "KINGSTON", population: "3M", continent: "NORTH AMERICA", code: "JM" },
            { name: "COSTA RICA", lat: 9.7489, lng: -83.7534, flag: "https://flagcdn.com/w320/cr.png", capital: "SAN JOSÉ", population: "5M", continent: "NORTH AMERICA", code: "CR" },
            { name: "PANAMA", lat: 8.5379, lng: -80.7821, flag: "https://flagcdn.com/w320/pa.png", capital: "PANAMA CITY", population: "4M", continent: "NORTH AMERICA", code: "PA" },
            
            // South America
            { name: "BRAZIL", lat: -14.2350, lng: -51.9253, flag: "https://flagcdn.com/w320/br.png", capital: "BRASÍLIA", population: "214M", continent: "SOUTH AMERICA", code: "BR" },
            { name: "ARGENTINA", lat: -38.4161, lng: -63.6167, flag: "https://flagcdn.com/w320/ar.png", capital: "BUENOS AIRES", population: "45M", continent: "SOUTH AMERICA", code: "AR" },
            { name: "COLOMBIA", lat: 4.5709, lng: -74.2973, flag: "https://flagcdn.com/w320/co.png", capital: "BOGOTÁ", population: "51M", continent: "SOUTH AMERICA", code: "CO" },
            { name: "PERU", lat: -9.1900, lng: -75.0152, flag: "https://flagcdn.com/w320/pe.png", capital: "LIMA", population: "33M", continent: "SOUTH AMERICA", code: "PE" },
            { name: "VENEZUELA", lat: 6.4238, lng: -66.5897, flag: "https://flagcdn.com/w320/ve.png", capital: "CARACAS", population: "28M", continent: "SOUTH AMERICA", code: "VE" },
            { name: "CHILE", lat: -35.6751, lng: -71.5430, flag: "https://flagcdn.com/w320/cl.png", capital: "SANTIAGO", population: "19M", continent: "SOUTH AMERICA", code: "CL" },
            { name: "ECUADOR", lat: -1.8312, lng: -78.1834, flag: "https://flagcdn.com/w320/ec.png", capital: "QUITO", population: "18M", continent: "SOUTH AMERICA", code: "EC" },
            { name: "BOLIVIA", lat: -16.2902, lng: -63.5887, flag: "https://flagcdn.com/w320/bo.png", capital: "SUCRE", population: "12M", continent: "SOUTH AMERICA", code: "BO" },
            { name: "PARAGUAY", lat: -23.4425, lng: -58.4438, flag: "https://flagcdn.com/w320/py.png", capital: "ASUNCIÓN", population: "7M", continent: "SOUTH AMERICA", code: "PY" },
            { name: "URUGUAY", lat: -32.5228, lng: -55.7658, flag: "https://flagcdn.com/w320/uy.png", capital: "MONTEVIDEO", population: "3M", continent: "SOUTH AMERICA", code: "UY" },
            
            // Europe
            { name: "UNITED KINGDOM", lat: 55.3781, lng: -3.4360, flag: "https://flagcdn.com/w320/gb.png", capital: "LONDON", population: "67M", continent: "EUROPE", code: "GB" },
            { name: "FRANCE", lat: 46.6034, lng: 1.8883, flag: "https://flagcdn.com/w320/fr.png", capital: "PARIS", population: "68M", continent: "EUROPE", code: "FR" },
            { name: "GERMANY", lat: 51.1657, lng: 10.4515, flag: "https://flagcdn.com/w320/de.png", capital: "BERLIN", population: "83M", continent: "EUROPE", code: "DE" },
            { name: "ITALY", lat: 41.8719, lng: 12.5674, flag: "https://flagcdn.com/w320/it.png", capital: "ROME", population: "59M", continent: "EUROPE", code: "IT" },
            { name: "SPAIN", lat: 40.4637, lng: -3.7492, flag: "https://flagcdn.com/w320/es.png", capital: "MADRID", population: "47M", continent: "EUROPE", code: "ES" },
            { name: "UKRAINE", lat: 48.3794, lng: 31.1656, flag: "https://flagcdn.com/w320/ua.png", capital: "KYIV", population: "41M", continent: "EUROPE", code: "UA" },
            { name: "POLAND", lat: 51.9194, lng: 19.1451, flag: "https://flagcdn.com/w320/pl.png", capital: "WARSAW", population: "38M", continent: "EUROPE", code: "PL" },
            { name: "ROMANIA", lat: 45.9432, lng: 24.9668, flag: "https://flagcdn.com/w320/ro.png", capital: "BUCHAREST", population: "19M", continent: "EUROPE", code: "RO" },
            { name: "NETHERLANDS", lat: 52.1326, lng: 5.2913, flag: "https://flagcdn.com/w320/nl.png", capital: "AMSTERDAM", population: "17M", continent: "EUROPE", code: "NL" },
            { name: "BELGIUM", lat: 50.5039, lng: 4.4699, flag: "https://flagcdn.com/w320/be.png", capital: "BRUSSELS", population: "12M", continent: "EUROPE", code: "BE" },
            { name: "SWEDEN", lat: 60.1282, lng: 18.6435, flag: "https://flagcdn.com/w320/se.png", capital: "STOCKHOLM", population: "10M", continent: "EUROPE", code: "SE" },
            { name: "NORWAY", lat: 60.4720, lng: 8.4689, flag: "https://flagcdn.com/w320/no.png", capital: "OSLO", population: "5M", continent: "EUROPE", code: "NO" },
            { name: "FINLAND", lat: 61.9241, lng: 25.7482, flag: "https://flagcdn.com/w320/fi.png", capital: "HELSINKI", population: "6M", continent: "EUROPE", code: "FI" },
            { name: "DENMARK", lat: 56.2639, lng: 9.5018, flag: "https://flagcdn.com/w320/dk.png", capital: "COPENHAGEN", population: "6M", continent: "EUROPE", code: "DK" },
            { name: "SWITZERLAND", lat: 46.8182, lng: 8.2275, flag: "https://flagcdn.com/w320/ch.png", capital: "BERN", population: "9M", continent: "EUROPE", code: "CH" },
            { name: "AUSTRIA", lat: 47.5162, lng: 14.5501, flag: "https://flagcdn.com/w320/at.png", capital: "VIENNA", population: "9M", continent: "EUROPE", code: "AT" },
            { name: "PORTUGAL", lat: 39.3999, lng: -8.2245, flag: "https://flagcdn.com/w320/pt.png", capital: "LISBON", population: "10M", continent: "EUROPE", code: "PT" },
            { name: "GREECE", lat: 39.0742, lng: 21.8243, flag: "https://flagcdn.com/w320/gr.png", capital: "ATHENS", population: "10M", continent: "EUROPE", code: "GR" },
            
            // Asia
            { name: "CHINA", lat: 35.8617, lng: 104.1954, flag: "https://flagcdn.com/w320/cn.png", capital: "BEIJING", population: "1.4B", continent: "ASIA", code: "CN" },
            { name: "INDIA", lat: 20.5937, lng: 78.9629, flag: "https://flagcdn.com/w320/in.png", capital: "NEW DELHI", population: "1.38B", continent: "ASIA", code: "IN" },
            { name: "JAPAN", lat: 36.2048, lng: 138.2529, flag: "https://flagcdn.com/w320/jp.png", capital: "TOKYO", population: "126M", continent: "ASIA", code: "JP" },
            { name: "RUSSIA", lat: 61.5240, lng: 105.3188, flag: "https://flagcdn.com/w320/ru.png", capital: "MOSCOW", population: "144M", continent: "ASIA", code: "RU" },
            { name: "INDONESIA", lat: -0.7893, lng: 113.9213, flag: "https://flagcdn.com/w320/id.png", capital: "JAKARTA", population: "273M", continent: "ASIA", code: "ID" },
            { name: "PAKISTAN", lat: 30.3753, lng: 69.3451, flag: "https://flagcdn.com/w320/pk.png", capital: "ISLAMABAD", population: "225M", continent: "ASIA", code: "PK" },
            { name: "BANGLADESH", lat: 23.6850, lng: 90.3563, flag: "https://flagcdn.com/w320/bd.png", capital: "DHAKA", population: "165M", continent: "ASIA", code: "BD" },
            { name: "PHILIPPINES", lat: 12.8797, lng: 121.7740, flag: "https://flagcdn.com/w320/ph.png", capital: "MANILA", population: "109M", continent: "ASIA", code: "PH" },
            { name: "VIETNAM", lat: 14.0583, lng: 108.2772, flag: "https://flagcdn.com/w320/vn.png", capital: "HANOI", population: "97M", continent: "ASIA", code: "VN" },
            { name: "TURKEY", lat: 38.9637, lng: 35.2433, flag: "https://flagcdn.com/w320/tr.png", capital: "ANKARA", population: "84M", continent: "ASIA", code: "TR" },
            { name: "IRAN", lat: 32.4279, lng: 53.6880, flag: "https://flagcdn.com/w320/ir.png", capital: "TEHRAN", population: "84M", continent: "ASIA", code: "IR" },
            { name: "THAILAND", lat: 15.8700, lng: 100.9925, flag: "https://flagcdn.com/w320/th.png", capital: "BANGKOK", population: "70M", continent: "ASIA", code: "TH" },
            { name: "SOUTH KOREA", lat: 35.9078, lng: 127.7669, flag: "https://flagcdn.com/w320/kr.png", capital: "SEOUL", population: "51M", continent: "ASIA", code: "KR" },
            { name: "MYANMAR", lat: 21.9162, lng: 95.9560, flag: "https://flagcdn.com/w320/mm.png", capital: "NAYPYIDAW", population: "54M", continent: "ASIA", code: "MM" },
            { name: "IRAQ", lat: 33.2232, lng: 43.6793, flag: "https://flagcdn.com/w320/iq.png", capital: "BAGHDAD", population: "40M", continent: "ASIA", code: "IQ" },
            { name: "AFGHANISTAN", lat: 33.9391, lng: 67.7100, flag: "https://flagcdn.com/w320/af.png", capital: "KABUL", population: "38M", continent: "ASIA", code: "AF" },
            { name: "SAUDI ARABIA", lat: 23.8859, lng: 45.0792, flag: "https://flagcdn.com/w320/sa.png", capital: "RIYADH", population: "35M", continent: "ASIA", code: "SA" },
            { name: "MALAYSIA", lat: 4.2105, lng: 101.9758, flag: "https://flagcdn.com/w320/my.png", capital: "KUALA LUMPUR", population: "32M", continent: "ASIA", code: "MY" },
            
            // Africa
            { name: "NIGERIA", lat: 9.0820, lng: 8.6753, flag: "https://flagcdn.com/w320/ng.png", capital: "ABUJA", population: "206M", continent: "AFRICA", code: "NG" },
            { name: "ETHIOPIA", lat: 9.1450, lng: 40.4897, flag: "https://flagcdn.com/w320/et.png", capital: "ADDIS ABABA", population: "115M", continent: "AFRICA", code: "ET" },
            { name: "EGYPT", lat: 26.8206, lng: 30.8025, flag: "https://flagcdn.com/w320/eg.png", capital: "CAIRO", population: "104M", continent: "AFRICA", code: "EG" },
            { name: "DEMOCRATIC REPUBLIC OF THE CONGO", lat: -4.0383, lng: 21.7587, flag: "https://flagcdn.com/w320/cd.png", capital: "KINSHASA", population: "89M", continent: "AFRICA", code: "CD" },
            { name: "SOUTH AFRICA", lat: -30.5595, lng: 22.9375, flag: "https://flagcdn.com/w320/za.png", capital: "PRETORIA", population: "60M", continent: "AFRICA", code: "ZA" },
            { name: "TANZANIA", lat: -6.3690, lng: 34.8888, flag: "https://flagcdn.com/w320/tz.png", capital: "DODOMA", population: "60M", continent: "AFRICA", code: "TZ" },
            { name: "KENYA", lat: -0.0236, lng: 37.9062, flag: "https://flagcdn.com/w320/ke.png", capital: "NAIROBI", population: "54M", continent: "AFRICA", code: "KE" },
            { name: "UGANDA", lat: 1.3733, lng: 32.2903, flag: "https://flagcdn.com/w320/ug.png", capital: "KAMPALA", population: "46M", continent: "AFRICA", code: "UG" },
            { name: "ALGERIA", lat: 28.0339, lng: 1.6596, flag: "https://flagcdn.com/w320/dz.png", capital: "ALGIERS", population: "44M", continent: "AFRICA", code: "DZ" },
            { name: "SUDAN", lat: 12.8628, lng: 30.2176, flag: "https://flagcdn.com/w320/sd.png", capital: "KHARTOUM", population: "44M", continent: "AFRICA", code: "SD" },
            { name: "MOROCCO", lat: 31.7917, lng: -7.0926, flag: "https://flagcdn.com/w320/ma.png", capital: "RABAT", population: "37M", continent: "AFRICA", code: "MA" },
            { name: "ANGOLA", lat: -11.2027, lng: 17.8739, flag: "https://flagcdn.com/w320/ao.png", capital: "LUANDA", population: "33M", continent: "AFRICA", code: "AO" },
            { name: "GHANA", lat: 7.9465, lng: -1.0232, flag: "https://flagcdn.com/w320/gh.png", capital: "ACCRA", population: "31M", continent: "AFRICA", code: "GH" },
            { name: "MOZAMBIQUE", lat: -18.6657, lng: 35.5296, flag: "https://flagcdn.com/w320/mz.png", capital: "MAPUTO", population: "31M", continent: "AFRICA", code: "MZ" },
            { name: "MADAGASCAR", lat: -18.7669, lng: 46.8691, flag: "https://flagcdn.com/w320/mg.png", capital: "ANTANANARIVO", population: "28M", continent: "AFRICA", code: "MG" },
            
            // Oceania
            { name: "AUSTRALIA", lat: -25.2744, lng: 133.7751, flag: "https://flagcdn.com/w320/au.png", capital: "CANBERRA", population: "26M", continent: "OCEANIA", code: "AU" },
            { name: "PAPUA NEW GUINEA", lat: -6.3150, lng: 143.9555, flag: "https://flagcdn.com/w320/pg.png", capital: "PORT MORESBY", population: "9M", continent: "OCEANIA", code: "PG" },
            { name: "NEW ZEALAND", lat: -40.9006, lng: 174.8860, flag: "https://flagcdn.com/w320/nz.png", capital: "WELLINGTON", population: "5M", continent: "OCEANIA", code: "NZ" },
            { name: "FIJI", lat: -17.7134, lng: 178.0650, flag: "https://flagcdn.com/w320/fj.png", capital: "SUVA", population: "900K", continent: "OCEANIA", code: "FJ" },
            { name: "SOLOMON ISLANDS", lat: -9.6457, lng: 160.1562, flag: "https://flagcdn.com/w320/sb.png", capital: "HONIARA", population: "687K", continent: "OCEANIA", code: "SB" }
        ];

        // Function to create flag markers
        function createFlagMarkers() {
            countries.forEach(country => {
                // Generate and store stats for each country
                countryStats[country.name] = generateInternetStats(country);
                
                // Create a custom flag icon
                const flagIcon = L.divIcon({
                    className: 'country-flag',
                    html: `<img src="${country.flag}" alt="${country.name} flag" style="width: 40px; height: 25px; border-radius: 3px; box-shadow: 0 2px 5px rgba(0,0,0,0.3);">`,
                    iconSize: [40, 25],
                    iconAnchor: [20, 12]
                });

                // Add marker to map
                const marker = L.marker([country.lat, country.lng], {
                    icon: flagIcon,
                    riseOnHover: true
                }).addTo(map);

                // Store marker for search functionality
                countryMarkers[country.name] = marker;

                // Add popup with country info
                marker.bindPopup(`
                    <div style="text-align: center; min-width: 200px;">
                        <img src="${country.flag}" alt="${country.name} flag" style="width: 100px; height: 60px; border-radius: 4px; margin-bottom: 10px; border: 2px solid #fff;">
                        <h3 style="margin: 10px 0; color: #4a9eff; text-transform: uppercase;">${country.name}</h3>
                        <div style="text-align: left; font-size: 12px; line-height: 1.5; text-transform: uppercase;">
                            <div><strong>CAPITAL:</strong> ${country.capital}</div>
                            <div><strong>POPULATION:</strong> ${country.population}</div>
                            <div><strong>CONTINENT:</strong> ${country.continent}</div>
                            <div><strong>INTERNET PENETRATION:</strong> ${countryStats[country.name].penetration}%</div>
                            <div><strong>DOWNLOAD SPEED:</strong> ${countryStats[country.name].download} MBPS</div>
                        </div>
                    </div>
                `);

                // Add click event to show detailed country page
                marker.on('click', function() {
                    showCountryDetail(country);
                });
            });
        }

        // Show detailed country page
        function showCountryDetail(country) {
            currentCountry = country;
            const stats = countryStats[country.name];
            
            // Update the detail page with country information
            document.getElementById('detailFlag').src = country.flag;
            document.getElementById('detailName').textContent = country.name;
            document.getElementById('detailCapital').textContent = country.capital;
            document.getElementById('detailContinent').textContent = country.continent;
            
            // Update internet statistics
            document.getElementById('internetPenetration').textContent = stats.penetration + '%';
            document.getElementById('internetUsers').textContent = stats.users;
            document.getElementById('mobileUsers').textContent = stats.mobileUsers;
            document.getElementById('broadbandUsers').textContent = stats.broadband;
            document.getElementById('pricePerGB').textContent = '$' + stats.price;
            
            // Update connection speed
            document.getElementById('downloadSpeed').textContent = stats.download + ' MBPS';
            document.getElementById('uploadSpeed').textContent = stats.upload + ' MBPS';
            document.getElementById('latency').textContent = stats.latency + ' MS';
            document.getElementById('globalRank').textContent = stats.rank;
            document.getElementById('gdpPerCapita').textContent = '$' + stats.gdp + 'K';
            
            // Update population & economy
            document.getElementById('population').textContent = country.population;
            document.getElementById('urbanPopulation').textContent = stats.urbanPopulation + '%';
            document.getElementById('medianAge').textContent = stats.medianAge;
            document.getElementById('gdpGrowth').textContent = stats.gdpGrowth + '%';
            document.getElementById('unemployment').textContent = stats.unemployment + '%';
            
            // Update infrastructure
            document.getElementById('infrastructureIndex').textContent = stats.infrastructureIndex;
            document.getElementById('fiveGCoverage').textContent = stats.fiveGCoverage + '%';
            document.getElementById('fiberOptic').textContent = stats.fiberOptic + '%';
            document.getElementById('publicWifi').textContent = stats.publicWifi;
            document.getElementById('lastUpdated').textContent = stats.lastUpdated;
            
            // Show the detail page and hide the map
            document.getElementById('countryDetail').classList.add('active');
            document.getElementById('map').style.opacity = '0.2';
            document.getElementById('countryInfo').classList.add('hidden');
            
            // Fetch news for the country
            fetchCountryNews(country);
            
            // Show weather for capital city
            fetchWeather(country.capital, country.code);
            
            // Update timezone
            updateTimezone(country);
            
            // Generate comparison chart
            generateComparisonChart(country);
            
            // Generate data visualization
            generateDataVisualization(country);
        }

        // Fetch country news
        async function fetchCountryNews(country) {
            const newsGrid = document.getElementById('newsGrid');
            newsGrid.innerHTML = `
                <div class="news-card">
                    <div class="news-source">LOADING...</div>
                    <div class="news-headline">Fetching latest news about ${country.name}</div>
                    <div class="news-date">--</div>
                </div>
            `;
            
            try {
                // Using a news API proxy to avoid CORS issues
                const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://news.google.com/rss/search?q=${encodeURIComponent(country.name)}+when:1d&hl=en-US&gl=US&ceid=US:en`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    newsGrid.innerHTML = '';
                    data.items.slice(0, 6).forEach(item => {
                        const newsCard = document.createElement('div');
                        newsCard.className = 'news-card';
                        newsCard.onclick = () => window.open(item.link, '_blank');
                        
                        const source = item.source || 'Unknown Source';
                        const title = item.title.length > 100 ? item.title.substring(0, 100) + '...' : item.title;
                        const date = new Date(item.pubDate).toLocaleDateString();
                        
                        newsCard.innerHTML = `
                            <div class="news-source">${source.toUpperCase()}</div>
                            <div class="news-headline">${title}</div>
                            <div class="news-date">${date}</div>
                        `;
                        
                        newsGrid.appendChild(newsCard);
                    });
                } else {
                    newsGrid.innerHTML = `
                        <div class="news-card">
                            <div class="news-source">NO NEWS</div>
                            <div class="news-headline">No recent news found for ${country.name}</div>
                            <div class="news-date">--</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error fetching news:', error);
                newsGrid.innerHTML = `
                    <div class="news-card">
                        <div class="news-source">ERROR</div>
                        <div class="news-headline">Failed to load news. Please try again later.</div>
                        <div class="news-date">--</div>
                    </div>
                `;
            }
        }

        // Fetch weather data
        async function fetchWeather(city, countryCode) {
            const weatherWidget = document.getElementById('weatherWidget');
            weatherWidget.style.display = 'block';
            
            document.getElementById('weatherTemp').textContent = '--°C';
            document.getElementById('weatherDesc').textContent = 'LOADING...';
            
            try {
                // Using OpenWeatherMap API (you would need to replace with your own API key)
                const apiKey = 'demo_key'; // Replace with actual API key
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)},${countryCode}&units=metric&appid=${apiKey}`);
                
                if (!response.ok) throw new Error('Weather data not available');
                
                const data = await response.json();
                document.getElementById('weatherTemp').textContent = `${Math.round(data.main.temp)}°C`;
                document.getElementById('weatherDesc').textContent = data.weather[0].description.toUpperCase();
            } catch (error) {
                console.error('Error fetching weather:', error);
                // Fallback to mock data
                const temp = Math.floor(Math.random() * 30) + 5;
                const conditions = ['SUNNY', 'CLOUDY', 'PARTLY CLOUDY', 'RAINY', 'CLEAR'];
                const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
                
                document.getElementById('weatherTemp').textContent = `${temp}°C`;
                document.getElementById('weatherDesc').textContent = randomCondition;
            }
        }

        // Update timezone display
        function updateTimezone(country) {
            const timezoneWidget = document.getElementById('timezoneWidget');
            timezoneWidget.style.display = 'block';
            
            // Calculate timezone offset based on longitude (simplified)
            const offsetHours = Math.floor(country.lng / 15);
            const now = new Date();
            now.setHours(now.getUTCHours() + offsetHours);
            
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'}).toUpperCase();
            const timezoneName = `UTC${offsetHours >= 0 ? '+' : ''}${offsetHours}`;
            
            document.getElementById('timezoneTime').textContent = timeString;
            document.getElementById('timezoneName').textContent = timezoneName;
            
            // Update time every second
            clearInterval(window.timezoneInterval);
            window.timezoneInterval = setInterval(() => {
                const newTime = new Date();
                newTime.setHours(newTime.getUTCHours() + offsetHours);
                document.getElementById('timezoneTime').textContent = newTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'}).toUpperCase();
            }, 1000);
        }

        // Generate comparison chart
        function generateComparisonChart(country) {
            const chartContainer = document.getElementById('chartContainer');
            const comparisonChart = document.getElementById('comparisonChart');
            
            // Show the chart
            comparisonChart.style.display = 'block';
            
            // Find similar countries for comparison
            const similarCountries = countries
                .filter(c => c.continent === country.continent && c.name !== country.name)
                .slice(0, 3);
            
            // Add the current country to comparison
            const countriesToCompare = [country, ...similarCountries];
            
            let chartHTML = '';
            
            // Compare download speeds
            chartHTML += '<div class="chart-bar"><div class="chart-label">DOWNLOAD SPEED</div></div>';
            countriesToCompare.forEach(c => {
                const speed = parseFloat(countryStats[c.name].download);
                const maxSpeed = 120; // Maximum speed for scaling
                const width = (speed / maxSpeed) * 100;
                
                chartHTML += `
                    <div class="chart-bar">
                        <div class="chart-label">${c.name}</div>
                        <div class="chart-value">
                            <div class="chart-fill" style="width: ${width}%"></div>
                        </div>
                        <div class="chart-number">${speed} MBPS</div>
                    </div>
                `;
            });
            
            // Compare internet penetration
            chartHTML += '<div class="chart-bar" style="margin-top: 20px;"><div class="chart-label">INTERNET PENETRATION</div></div>';
            countriesToCompare.forEach(c => {
                const penetration = parseFloat(countryStats[c.name].penetration);
                const width = penetration; // Already a percentage
                
                chartHTML += `
                    <div class="chart-bar">
                        <div class="chart-label">${c.name}</div>
                        <div class="chart-value">
                            <div class="chart-fill" style="width: ${width}%"></div>
                        </div>
                        <div class="chart-number">${penetration}%</div>
                    </div>
                `;
            });
            
            chartContainer.innerHTML = chartHTML;
        }

        // Generate data visualization
        function generateDataVisualization(country) {
            const visualizationGrid = document.getElementById('visualizationGrid');
            const stats = countryStats[country.name];
            
            // Create visualization cards for different metrics
            const metrics = [
                { name: 'INTERNET USERS', value: stats.users, max: '100M' },
                { name: 'DOWNLOAD SPEED', value: stats.download + ' MBPS', max: '120 MBPS' },
                { name: 'UPLOAD SPEED', value: stats.upload + ' MBPS', max: '80 MBPS' },
                { name: 'INFRASTRUCTURE', value: stats.infrastructureIndex, max: '100' }
            ];
            
            let visualizationHTML = '';
            
            metrics.forEach(metric => {
                // Create a simple bar chart visualization
                let valueNum = parseFloat(metric.value);
                let maxNum = parseFloat(metric.max);
                
                // For non-numeric values like "47.6M", use a percentage
                if (isNaN(valueNum)) {
                    // Extract numeric part from strings like "47.6M"
                    valueNum = parseFloat(metric.value.replace(/[^\d.]/g, ''));
                    maxNum = parseFloat(metric.max.replace(/[^\d.]/g, ''));
                }
                
                const percentage = Math.min(100, (valueNum / maxNum) * 100);
                
                // Generate random bar heights for the visualization
                let barsHTML = '';
                for (let i = 0; i < 12; i++) {
                    const height = Math.random() * 80 + 20;
                    barsHTML += `<div class="visualization-bar" style="height: ${height}%"></div>`;
                }
                
                visualizationHTML += `
                    <div class="visualization-card">
                        <div class="visualization-header">
                            <div class="visualization-name">${metric.name}</div>
                            <div class="visualization-value">${metric.value}</div>
                        </div>
                        <div class="visualization-chart">
                            ${barsHTML}
                        </div>
                    </div>
                `;
            });
            
            visualizationGrid.innerHTML = visualizationHTML;
        }

        // Update comparison panel with top countries
        function updateComparisonPanel() {
            const comparisonPanel = document.getElementById('comparisonPanel');
            const comparisonList = document.getElementById('comparisonList');
            
            // Get top 5 countries by download speed
            const topCountries = countries
                .map(country => ({
                    name: country.name,
                    speed: parseFloat(countryStats[country.name].download)
                }))
                .sort((a, b) => b.speed - a.speed)
                .slice(0, 5);
            
            let comparisonHTML = '';
            
            topCountries.forEach((country, index) => {
                comparisonHTML += `
                    <div class="comparison-item">
                        <span class="comparison-country">${index + 1}. ${country.name}</span>
                        <span class="comparison-value">${country.speed} MBPS</span>
                    </div>
                `;
            });
            
            comparisonList.innerHTML = comparisonHTML;
        }

        // Filter countries by continent
        function filterCountriesByContinent() {
            const continents = {
                'AFRICA': document.getElementById('filterAfrica').checked,
                'ASIA': document.getElementById('filterAsia').checked,
                'EUROPE': document.getElementById('filterEurope').checked,
                'NORTH AMERICA': document.getElementById('filterNorthAmerica').checked,
                'SOUTH AMERICA': document.getElementById('filterSouthAmerica').checked,
                'OCEANIA': document.getElementById('filterOceania').checked
            };
            
            // Show/hide markers based on continent filter
            countries.forEach(country => {
                const marker = countryMarkers[country.name];
                if (marker) {
                    if (continents[country.continent]) {
                        map.addLayer(marker);
                    } else {
                        map.removeLayer(marker);
                    }
                }
            });
        }

        // Export data as CSV
        function exportData() {
            let csvContent = "Country,Capital,Population,Continent,Internet Penetration (%),Download Speed (Mbps),Upload Speed (Mbps),GDP Per Capita ($K)\n";
            
            countries.forEach(country => {
                const stats = countryStats[country.name];
                csvContent += `"${country.name}","${country.capital}","${country.population}","${country.continent}",${stats.penetration},${stats.download},${stats.upload},${stats.gdp}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "world_flag_map_data.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Search functionality
        document.getElementById('searchBar').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toUpperCase();
            const searchResults = document.getElementById('searchResults');
            
            if (searchTerm.length < 2) {
                searchResults.style.display = 'none';
                return;
            }
            
            const filteredCountries = countries.filter(country => 
                country.name.includes(searchTerm) || 
                country.capital.includes(searchTerm)
            );
            
            searchResults.innerHTML = '';
            
            if (filteredCountries.length > 0) {
                filteredCountries.slice(0, 5).forEach(country => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.textContent = `${country.name} - ${country.capital}`;
                    resultItem.onclick = () => {
                        // Fly to country on map
                        map.flyTo([country.lat, country.lng], 5);
                        // Open country detail
                        showCountryDetail(country);
                        // Clear search
                        document.getElementById('searchBar').value = '';
                        searchResults.style.display = 'none';
                    };
                    searchResults.appendChild(resultItem);
                });
                searchResults.style.display = 'block';
            } else {
                const noResult = document.createElement('div');
                noResult.className = 'search-result-item';
                noResult.textContent = 'NO RESULTS FOUND';
                searchResults.appendChild(noResult);
                searchResults.style.display = 'block';
            }
        });

        // Hide search results when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                document.getElementById('searchResults').style.display = 'none';
            }
        });

        // Create flag markers
        createFlagMarkers();

        // Hide loading after markers are created
        setTimeout(() => {
            document.getElementById('loading').style.display = 'none';
            // Update comparison panel
            updateComparisonPanel();
        }, 1500);

        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        themeToggle.addEventListener('click', function() {
            if (body.classList.contains('dark-mode')) {
                // Switch to light mode
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                
                // Switch map tiles
                map.removeLayer(darkLayer);
                lightLayer.addTo(map);
            } else {
                // Switch to dark mode
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                
                // Switch map tiles
                map.removeLayer(lightLayer);
                darkLayer.addTo(map);
            }
        });

        // Back button functionality
        document.getElementById('backButton').addEventListener('click', function() {
            document.getElementById('countryDetail').classList.remove('active');
            document.getElementById('map').style.opacity = '1';
            document.getElementById('countryInfo').classList.remove('hidden');
            document.getElementById('weatherWidget').style.display = 'none';
            document.getElementById('timezoneWidget').style.display = 'none';
            document.getElementById('comparisonChart').style.display = 'none';
            
            // Clear timezone interval
            clearInterval(window.timezoneInterval);
        });

        // Filter toggle functionality
        document.getElementById('filterToggle').addEventListener('click', function() {
            const filterPanel = document.getElementById('filterPanel');
            filterPanel.classList.toggle('hidden');
        });

        // Comparison toggle functionality
        document.getElementById('comparisonToggle').addEventListener('click', function() {
            const comparisonPanel = document.getElementById('comparisonPanel');
            comparisonPanel.classList.toggle('hidden');
        });

        // Reset view functionality
        document.getElementById('resetView').addEventListener('click', function() {
            map.setView([20, 0], 2);
        });

        // Export button functionality
        document.getElementById('exportButton').addEventListener('click', function() {
            exportData();
        });

        // Filter change event listeners
        document.querySelectorAll('.filter-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', filterCountriesByContinent);
        });

        // Add click event to show coordinates
        map.on('click', function(e) {
            L.popup()
                .setLatLng(e.latlng)
                .setContent(`
                    <div style="text-align: center; text-transform: uppercase;">
                        <p>LAT: ${e.latlng.lat.toFixed(4)}</p>
                        <p>LNG: ${e.latlng.lng.toFixed(4)}</p>
                    </div>
                `)
                .openOn(map);
        });

        // Adjust flag sizes based on zoom level
        map.on('zoomend', function() {
            const zoom = map.getZoom();
            const flagSize = Math.max(20, Math.min(60, 20 + (zoom - 2) * 5));
            
            // Update all flag markers
            document.querySelectorAll('.country-flag img').forEach(img => {
                img.style.width = `${flagSize}px`;
                img.style.height = `${flagSize * 0.625}px`; // Maintain 5:8 flag ratio
            });
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape key to go back to map
            if (e.key === 'Escape' && document.getElementById('countryDetail').classList.contains('active')) {
                document.getElementById('backButton').click();
            }
            
            // Ctrl+F to focus search
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchBar').focus();
            }
            
            // T key to toggle theme
            if (e.key === 't') {
                themeToggle.click();
            }
        });
    </script>
</body>
</html>